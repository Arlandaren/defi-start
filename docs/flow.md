
### Конкретный флоу, алгоритмы и формулы расчёта комбинированной DeFi-стратегии

---

#### Общий поток процессов (Flow)

1. **Инициализация системы:**
    - Установка начальных параметров и подключение к биржам и DeFi-протоколам.
    - Определение доступного капитала для инвестирования.

2. **Сбор и обработка данных:**
    - Получение в реальном времени данных о:
        - Ставках фондирования на различных биржах.
        - Ценах и ликвидности активов.
        - Доходностях и параметрах пулов ликвидности.
        - Процентных ставках и условиях кредитных протоколов.

3. **Анализ и выявление возможностей:**
    - **Арбитраж:** Определение бирж с наибольшей разницей в ставках фондирования.
    - **Стейкинг ликвидности:** Выбор пулов с наилучшим соотношением доходности и риска.
    - **Кредитование:** Оценка доступности и выгодности обеспеченных займов.
    - **Алгоритмическое распределение:** Расчет оптимального распределения капитала между стратегиями.

4. **Исполнение стратегий:**
    - **Арбитраж ставок фондирования:** Открытие хеджированных позиций на разных биржах.
    - **Хеджированный стейкинг ликвидности:** Предоставление ликвидности в пул с одновременным хеджированием рисков.
    - **Обеспеченные займы:** Депонирование активов для получения займов и реинвестирование полученных средств.

5. **Мониторинг и ребалансировка:**
    - Постоянное отслеживание рынка и позиций.
    - Ребалансировка портфеля на основе алгоритмического решения.
    - Управление рисками и предотвращение ликвидационных событий.

6. **Закрытие позиций и фиксация прибыли:**
    - Автоматическое или ручное закрытие позиций при достижении целевых показателей.
    - Реинвестирование прибыли или вывод средств.

---

2. **Расчёт разницы ставок фондирования:**

### Подробные алгоритмы и формулы расчёта

---

#### **1. Арбитраж ставок фондирования**

**Цель:** Извлечь прибыль из разницы ставок фондирования на разных биржах без рыночного риска.

**Шаги:**

1. **Сбор данных:**

    - Получить текущие ставки фондирования $$\( F_A \)$$ и $$\( F_B \)$$ для выбранного актива на биржах A и B.
    - Получить информацию о комиссиях и других транзакционных издержках $$\( C_A \)$$ и $$\( C_B \)$$.
    - Определить период фондирования $$\( T \)$$ (обычно выражается в долях суток, например, если ставка начисляется каждые 8 часов, то $$\( T = \frac{8}{24} \))$$.

2. **Расчёт разницы ставок фондирования:**

    - $$\( \Delta F = F_B - F_A \).$$

3. **Проверка арбитражной возможности:**

    - Если $$\( \Delta F > C_A + C_B + \text{Минимальная ожидаемая прибыль} \)$$, то продолжаем.
    - Учитываем, что комиссии могут включать торговые комиссии и издержки на вывод/ввод средств.

4. **Открытие позиций:**

    - **На бирже A:**
        - Открыть **длинную позицию (лонг)** объёмом $$\( Q \)$$ в базовом активе.
    - **На бирже B:**
        - Открыть **короткую позицию (шорт)** объёмом $$\( Q \)$$ в том же активе.

5. **Хеджирование рыночного риска:**

    - Позиции на бирже A и B компенсируют друг друга, нейтрализуя экспозицию к движению цены актива.
    - Общая позиция по активу равна нулю.

6. **Расчёт прибыли за период фондирования $$\( T \)$$:**

    - **Доход от ставок фондирования:**
        - На бирже A (лонг):
            - Обычно платится ставка фондирования: $$\( P_{\text{fund\_A}} = -Q \times F_A \times T \).$$
        - На бирже B (шорт):
            - Обычно получают ставку фондирования: $$\( P_{\text{fund\_B}} = Q \times F_B \times T \).$$
        - **Общий доход от ставок фондирования:**
            - $$\( P_{\text{fund}} = P_{\text{fund\_A}} + P_{\text{fund\_B}} = Q \times (F_B - F_A) \times T = Q \times \Delta F \times T \).$$

   -**Комиссии и издержки:**
    - Торговые комиссии при открытии и закрытии позиций:
        - $$\( C_{\text{trade}} = Q \times (C_{A,\text{open}} + C_{A,\text{close}} + C_{B,\text{open}} + C_{B,\text{close}}) \).$$
    - Другие возможные издержки (например, комиссии за финансирование маржи).
    - **Общие комиссии и издержки:**
        - $$\( C_{\text{total}} = C_{\text{trade}} + \text{Другие издержки} \).$$

    - **Чистая прибыль:**
        - $$\( P_{\text{net}} = P_{\text{fund}} - C_{\text{total}} \).$$

7.**Закрытие позиций:**

- По завершении периода фондирования закрыть обе позиции.
- Учитывать возможные изменения комиссий на момент закрытия.

8.**Реинвестирование прибыли:**

- Полученную чистую прибыль $$\( P_{\text{net}} \)$$ можно реинвестировать в другие стратегии, например, в хеджированный стейкинг ликвидности.

---

#### **2. Хеджированный стейкинг ликвидности**

**Цель:** Получать доход от предоставления ликвидности в AMM-пулы, одновременно хеджируя риски имперманентного убытка и волатильности цен.

**Шаги:**

1. **Выбор пула ликвидности:**

    - Выбрать AMM-пул (например, Uniswap V2) с парой токенов $$\( A \)$$ и $$\( B \)$$.
    - Оценить ожидаемую доходность от комиссий пула.
    - Учесть ликвидность пула и объемы торгов.

2. **Расчёт доли участия и депонируемых средств:**

    - Определить сумму средств $$\( V \)$$, которую планируется вложить.
    - Рассчитать количество токенов $$\( Q_A \)$$ и $$\( Q_B \)$$, необходимых для предоставления ликвидности:
        - Согласно текущему ценовому соотношению: $$\( Q_A = \frac{V}{2 \times P_{AB}} \), \( Q_B = \frac{V}{2} \)$$, где $$\( P_{AB} \) — цена токена \( A \) в токенах \( B \).$$

3. **Предоставление ликвидности:**

    - Депонировать $$\( Q_A \) и \( Q_B \)$$ в пул, получив LP-токены.

4. **Оценка риска имперманентного убытка (IL):**

    - **Имперманентный убыток** при изменении цены на $$\( x \% \)$$ рассчитывается по формуле:
        - $$\( IL(x) = 2 \times \sqrt{1 + x} / (1 + x) - 1 \).$$
    - Например, при росте цены на 10% $$(\( x = 0.1 \))$$:
        - $$\( IL(0.1) = 2 \times \sqrt{1 + 0.1} / (1 + 0.1) - 1 \).$$

5. **Хеджирование ценового риска:**

    - **Открытие короткой позиции:** на токен $$\( A \)$$ объёмом \( Q_A \)$$.
        - Использовать деривативы (фьючерсы или опционы).
          -**Цель:**если цена $$\( A \)$$ изменится, прибыль/убыток от короткой позиции компенсирует имперманентный убыток.

6.**Расчёт общей доходности:**

-**Доход от комиссий пула $$\( P_{\text{fees}} \)$$.**
-**Расходы на хеджирование $$\( C_{\text{hedge}} \)$$:**
- Комиссии за открытие/закрытие деривативных позиций.
- Возможная ставка фондирования на короткую позицию.
-**Чистая прибыль:**
- $$\( P_{\text{net}} = P_{\text{fees}} - IL - C_{\text{hedge}} \).$$

7. **Мониторинг и ребалансировка:**

    - **Постоянно отслеживать** цены токенов $$\( A \) и \( B \).$$
    - **Ребалансировать хеджирующую позицию** при существенных изменениях цены.
    - **Учесть издержки ребалансировки.**

8. **Выход из позиции:**

    - При желании выйти из стратегии:
        - Изъять ликвидность из пула.
        - Закрыть хеджирующую позицию.
        - Рассчитать итоговую прибыль или убыток.

---

#### **3. Обеспеченные займы**

**Цель:** Использовать активы в качестве залога для получения займов и увеличения эффективности капитала.

**Шаги:**

1. **Выбор кредитного протокола:**

    - Рассмотреть протоколы, такие как Aave, Compound или MakerDAO.
    - Оценить доступные процентные ставки по займам и депозитам.

2. **Депонирование залога:**

    - Депонировать активы $$\( Collateral \)$$ (например, ETH).
    - Рассчитать **коэффициент обеспечения (Collateral Ratio)**:
        - $$\( CR = \frac{Стоимость\ Collateral}{Сумма\ Займа} \).$$

3. **Получение займа:**

    - Получить заем $$\( Loan \)$$ в другом активе (например, DAI).
    - Учитывать **минимальный коэффициент обеспечения (MCR)**, требуемый протоколом (например, 150%).

4. **Инвестирование заемных средств:**

    - Вложить $$\( Loan \)$$ в другие стратегии:
        - **Увеличить объем арбитражных операций.**
        - **Добавить ликвидность в пул.**
        - **Дополнительно хеджировать риски.**

5. **Расчёт доходности:**

    - **Доход от инвестирования заемных средств $$\( P_{\text{invest}} \)$$.**
    - **Процентные расходы по займу $$\( C_{\text{interest}} = Loan \times R_{\text{loan}} \times T \), где \( R_{\text{loan}} \)$$ — годовая процентная ставка.**
    - **Чистая прибыль:**
        - $$\( P_{\text{net}} = P_{\text{invest}} - C_{\text{interest}} \).$$

6.**Управление рисками ликвидации:**

- Мониторить**коэффициент обеспечения (CR)**.
- Если цена залогового актива падает:
  -**Добавить дополнительный залог**.
  -**Погасить часть займа**.

7.**Погашение займа и вывод залога:**

- По завершении инвестиционного периода:
    - Погасить основной долг $$\( Loan \)$$ плюс начисленные проценты $$\( C_{\text{interest}} \)$$.
    - Вывести залоговые активы.

---

#### **4. Алгоритмическое распределение капитала**

**Цель:** Оптимизировать распределение капитала между разными стратегиями на основе текущих рыночных условий.

**Шаги:**

1. **Сбор рыночных данных:**

    - **Исторические и текущие данные** по доходности и рискам каждой стратегии.
    - **Рыночные индикаторы**: волатильность, тренды, ликвидность.

2. **Установление целевых параметров:**

    - **Ожидаемая доходность$$ (\( \mu \))$$** для каждой стратегии.
    - **Ожидаемый риск $$(\( \sigma \))$$** (например, стандартное отклонение доходности).
    - **Корреляция $$(\( \rho \))$$** между стратегиями.
3. **Оптимизация портфеля (продолжение):**

    - **Модель средней–вариации (Mean-Variance Optimization):**

        - **Целевая функция:**

            - Максимизировать ожидаемую доходность портфеля $$\( \mu_{\text{портфеля}} = \sum_{i} w_i \mu_i \), где \( \mu_i \)$$— ожидаемая доходность стратегии $$\( i \)$$.

            - Общий риск портфеля (вариация) рассчитывается как:

              $$\( \sigma_{\text{портфеля}}^2 = \sum_{i} \sum_{j} w_i w_j \sigma_i \sigma_j \rho_{ij} \)$$,

              где:
                - $$\( \sigma_i \) — стандартное отклонение (риск) стратегии \( i \)$$,
                - $$\( \rho_{ij} \) — корреляция доходностей стратегий \( i \) и \( j \)$$.

      -**Решение оптимизационной задачи:**

        - Используя методы квадратичного программирования, найти веса $$\( w_i \)$$, которые максимизируют $$\( U = \mu_{\text{портфеля}}$$ - $$\lambda \sigma_{\text{портфеля}}^2 \)$$ при заданных ограничениях.

4. **Реализация распределения:**

    - **Установить веса для каждой стратегии:**

        - После оптимизации получаем оптимальные веса $$\( w_i \)$$ для стратегий.

   -**Распределить капитал, используя полученные веса:**

    - Инвестировать $$\( K_i = w_i \times K_{\text{общий}} \)$$, где $$\( K_{\text{общий}} \)$$ — общий доступный капитал.

5.**Непрерывный мониторинг и ребалансировка:**

-**Регулярно пересчитывать оптимальные веса:**

     - При изменении рыночных условий или по заданному интервалу времени.

-**Проводить ребалансировку портфеля:**

     - Корректировать распределение капитала в соответствии с новыми весами.

---

### Дополнительные расчёты

-**Расчёт доходности и риска стратегий:**

-**Ожидаемая доходность стратегии $$\( \mu_i \)$$:**

    - \( \mu_i = \frac{1}{N} \sum_{t=1}^{N} r_{i,t} \), где \( r_{i,t} \) — доходность стратегии \( i \) в период \( t \).

-**Стандартное отклонение стратегии \( \sigma_i \):**

    - \( \sigma_i = \sqrt{\frac{1}{N - 1} \sum_{t=1}^{N} (r_{i,t} - \mu_i)^2} \).

-**Корреляция между стратегиями \( \rho_{ij} \):**

    - \( \rho_{ij} = \frac{\text{Cov}(r_i, r_j)}{\sigma_i \sigma_j} \),
    - где \( \text{Cov}(r_i, r_j) \) — ковариация доходностей стратегий \( i \) и \( j \):

      \( \text{Cov}(r_i, r_j) = \frac{1}{N - 1} \sum_{t=1}^{N} (r_{i,t} - \mu_i)(r_{j,t} - \mu_j) \).

---

### Итоговая схема комбинированной стратегии

-**Начальный капитал \( K_{\text{общий}} \) распределяется между стратегиями:**

-**Арбитраж ставок фондирования:**

    - Инвестируется сумма \( K_{\text{арбитраж}} = w_{\text{арбитраж}} \times K_{\text{общий}} \).

    - Проводятся арбитражные операции по описанному алгоритму.

- **Хеджированный стейкинг ликвидности:**

    - Инвестируется сумма \( K_{\text{стейкинг}} = w_{\text{стейкинг}} \times K_{\text{общий}} \).

    - Предоставление ликвидности и хеджирование проводится по описанному алгоритму.

-**Обеспеченные займы:**

    - Инвестируется сумма \( K_{\text{займы}} = w_{\text{займы}} \times K_{\text{общий}} \).

    - Полученные займы увеличивают доступный капитал и могут быть распределены между другими стратегиями.

- **Регулярный мониторинг:**

    - **Общий портфель мониторится по следующим параметрам:**

        - **Доходность портфеля \( \mu_{\text{портфеля}} \).**

        - **Риск портфеля \( \sigma_{\text{портфеля}} \).**

        - **Коэффициент Шарпа:**

            - \( S = \frac{\mu_{\text{портфеля}} - r_f}{\sigma_{\text{портфеля}}} \), где \( r_f \) — безрисковая ставка доходности.

    - **При необходимости выполняется ребалансировка с обновлёнными весами.**

---

### Пример расчёта (условный)

Предположим, у нас есть:

- **Стратегии:**

    - **Арбитраж ставок фондирования:**

        - Ожидаемая доходность \( \mu_1 = 0.02 \) (2% за период).
        - Стандартное отклонение \( \sigma_1 = 0.005 \) (0.5%).

    - **Хеджированный стейкинг ликвидности:**

        - Ожидаемая доходность \( \mu_2 = 0.015 \) (1.5% за период).
        - Стандартное отклонение \( \sigma_2 = 0.007 \) (0.7%).

    - **Обеспеченные займы:**

        - Ожидаемая доходность \( \mu_3 = 0.01 \) (1% за период).
        - Стандартное отклонение \( \sigma_3 = 0.003 \) (0.3%).

- **Корреляция между стратегиями:**

    - \( \rho_{12} = 0.2 \), \( \rho_{13} = 0.1 \), \( \rho_{23} = 0.15 \).

-**Коэффициент неприятия риска \( \lambda = 3 \).**

-**Безрисковая ставка \( r_f = 0.005 \) (0.5%).**

**Шаги:**

1.**Составляем матрицу ковариации:**
**Дано:**

- **Ожидаемые доходности стратегий:**
    - \(\mu_1 = 0.02\) (2% за период)
    - \(\mu_2 = 0.015\) (1.5% за период)
    - \(\mu_3 = 0.01\) (1% за период)

-**Стандартные отклонения (риски) стратегий:**
- \(\sigma_1 = 0.005\) (0.5%)
- \(\sigma_2 = 0.007\) (0.7%)
- \(\sigma_3 = 0.003\) (0.3%)

- **Корреляции между стратегиями:**
    - \(\rho_{12} = 0.2\)
    - \(\rho_{13} = 0.1\)
    - \(\rho_{23} = 0.15\)

-**Коэффициент неприятия риска**: \(\lambda = 3\)

-**Безрисковая ставка**: \(r_f = 0.005\) (0.5%)

**Цель:** Найти оптимальные веса \( w_1, w_2, w_3 \) для стратегий, чтобы максимизировать целевую функцию:

\[
U = \mu_{\text{портфеля}} - \lambda \sigma_{\text{портфеля}}^2
\]

с условием:

\[
w_1 + w_2 + w_3 = 1
\]

где:

\[
\mu_{\text{портфеля}} = w_1 \mu_1 + w_2 \mu_2 + w_3 \mu_3
\]

\[
\sigma_{\text{портфеля}}^2 = w_1^2 \sigma_1^2 + w_2^2 \sigma_2^2 + w_3^2 \sigma_3^2 + 2 w_1 w_2 \sigma_1 \sigma_2 \rho_{12} + 2 w_1 w_3 \sigma_1 \sigma_3 \rho_{13} + 2 w_2 w_3 \sigma_2 \sigma_3 \rho_{23}
\]

**Используем метод лагранжевых множителей для решения оптимизационной задачи.**

**1. Формируем функцию Лагранжа:**

\[
\mathcal{L} = \mu_{\text{портфеля}} - \lambda \sigma_{\text{портфеля}}^2 - \gamma(w_1 + w_2 + w_3 - 1)
\]

где \(\gamma\) — множитель Лагранжа для ограничения суммы весов.

**2. Выводим первые производные по каждому весу и приравниваем их к нулю:**

\[
\frac{\partial \mathcal{L}}{\partial w_i} = 0
\]

**Вычислим производные:**

Для каждого \( w_i \) (где \( i = 1, 2, 3 \)):

\[
\frac{\partial \mathcal{L}}{\partial w_i} = \mu_i - 2\lambda \left( \frac{\partial \sigma_{\text{портфеля}}^2}{\partial w_i} \right) - \gamma = 0
\]

**Вычислим \(\frac{\partial \sigma_{\text{портфеля}}^2}{\partial w_i}\):**

\(
\frac{\partial \sigma_{\text{портфеля}}^2}{\partial w_i} = 2 w_i \sigma_i^2 + 2 \sum_{j \neq i} w_j \sigma_i \sigma_j \rho_{ij}
\)

**Подставляем в уравнение для каждой стратегии:**

**Для \( w_1 \):**

\[
\mu_1 - 2\lambda \left( 2 w_1 \sigma_1^2 + 2 w_2 \sigma_1 \sigma_2 \rho_{12} + 2 w_3 \sigma_1 \sigma_3 \rho_{13} \right) - \gamma = 0
\]

**Аналогично для \( w_2 \) и \( w_3 \).**

**3. Получаем систему уравнений:**

**Уравнение (1):**

\[
\mu_1 - 2\lambda \left( 2 w_1 \sigma_1^2 + 2 w_2 \sigma_1 \sigma_2 \rho_{12} + 2 w_3 \sigma_1 \sigma_3 \rho_{13} \right) - \gamma = 0
\]

**Уравнение (2):**

\[
\mu_2 - 2\lambda \left( 2 w_2 \sigma_2^2 + 2 w_1 \sigma_1 \sigma_2 \rho_{12} + 2 w_3 \sigma_2 \sigma_3 \rho_{23} \right) - \gamma = 0
\]

**Уравнение (3):**

\[
\mu_3 - 2\lambda \left( 2 w_3 \sigma_3^2 + 2 w_1 \sigma_1 \sigma_3 \rho_{13} + 2 w_2 \sigma_2 \sigma_3 \rho_{23} \right) - \gamma = 0
\]

**Уравнение (4):**(ограничение на сумму весов)

\[
w_1 + w_2 + w_3 = 1
\]

**4. Упростим уравнения:**

Разделим каждое слагаемое на 2 и перепишем уравнения для удобства.

**Уравнение (1):**

\[
\mu_1 - 2\lambda \left( w_1 \sigma_1^2 + w_2 \sigma_1 \sigma_2 \rho_{12} + w_3 \sigma_1 \sigma_3 \rho_{13} \right) - \gamma = 0
\]

**Уравнение (2):**

\[
\mu_2 - 2\lambda \left( w_2 \sigma_2^2 + w_1 \sigma_1 \sigma_2 \rho_{12} + w_3 \sigma_2 \sigma_3 \rho_{23} \right) - \gamma = 0
\]

**Уравнение (3):**

\[
\mu_3 - 2\lambda \left( w_3 \sigma_3^2 + w_1 \sigma_1 \sigma_3 \rho_{13} + w_2 \sigma_2 \sigma_3 \rho_{23} \right) - \gamma = 0
\]

**5. Вычтем из уравнений (1) и (2) уравнение (3) для исключения \(\gamma\):**

Например, возьмем уравнение (1) и вычтем из него уравнение (3):

\[
(\mu_1 - \mu_3) - 2\lambda \left( [w_1 \sigma_1^2 - w_3 \sigma_3^2] + [w_2 \sigma_1 \sigma_2 \rho_{12} - w_2 \sigma_2 \sigma_3 \rho_{23}] + [w_3 \sigma_1 \sigma_3 \rho_{13} - w_1 \sigma_1 \sigma_3 \rho_{13}] \right) = 0
\]

Однако такой подход оказывается громоздким. Вместо этого проще рассмотреть систему уравнений и представить её в матричном виде, но без записи матрицы ковариаций.

**6. Решим систему уравнений численно.**

Перепишем систему уравнений, подставляя известные значения:

**Уравнение (1):**

\[
0.02 - 2\lambda \left( w_1 \times (0.005)^2 + w_2 \times 0.005 \times 0.007 \times 0.2 + w_3 \times 0.005 \times 0.003 \times 0.1 \right) - \gamma = 0
\]

**Уравнение (2):**

\[
0.015 - 2\lambda \left( w_2 \times (0.007)^2 + w_1 \times 0.005 \times 0.007 \times 0.2 + w_3 \times 0.007 \times 0.003 \times 0.15 \right) - \gamma = 0
\]

**Уравнение (3):**

\[
0.01 - 2\lambda \left( w_3 \times (0.003)^2 + w_1 \times 0.005 \times 0.003 \times 0.1 + w_2 \times 0.007 \times 0.003 \times 0.15 \right) - \gamma = 0
\]

**Уравнение (4):**

\[
w_1 + w_2 + w_3 = 1
\]

**Теперь подставим численные значения и упростим выражения.**

Сначала вычислим необходимые коэффициенты:

- \( (0.005)^2 = 0.000025 \)
- \( (0.007)^2 = 0.000049 \)
- \( (0.003)^2 = 0.000009 \)
- \( 0.005 \times 0.007 \times 0.2 = 0.000007 \)
- \( 0.005 \times 0.003 \times 0.1 = 0.0000015 \)
- \( 0.007 \times 0.003 \times 0.15 = 0.00000315 \)

Теперь перепишем уравнения:

**Уравнение (1):**

\[
0.02 - 2 \times 3 \left( w_1 \times 0.000025 + w_2 \times 0.000007 + w_3 \times 0.0000015 \right) - \gamma = 0
\]

\[
0.02 - 6 \left( 0.000025 w_1 + 0.000007 w_2 + 0.0000015 w_3 \right) - \gamma = 0
\]

**Уравнение (2):**

\[
0.015 - 6 \left( 0.000049 w_2 + 0.000007 w_1 + 0.00000315 w_3 \right) - \gamma = 0
\]

**Уравнение (3):**

\[
0.01 - 6 \left( 0.000009 w_3 + 0.0000015 w_1 + 0.00000315 w_2 \right) - \gamma = 0
\]

**7. Составим систему линейных уравнений для \( w_1, w_2, w_3 \).**

**Уравнение (1):**

\[
0.02 - 6 \times \left( 0.000025 w_1 + 0.000007 w_2 + 0.0000015 w_3 \right) - \gamma = 0
\]

**Уравнение (2):**

\[
0.015 - 6 \times \left( 0.000007 w_1 + 0.000049 w_2 + 0.00000315 w_3 \right) - \gamma = 0
\]

**Уравнение (3):**

\[
0.01 - 6 \times \left( 0.0000015 w_1 + 0.00000315 w_2 + 0.000009 w_3 \right) - \gamma = 0
\]

**8. Вычтем уравнение (3) из уравнений (1) и (2) для исключения \(\gamma\).**

**Уравнение (1) минус уравнение (3):**

\[
(0.02 - 0.01) - 6 \left( (0.000025 - 0.0000015) w_1 + (0.000007 - 0.00000315) w_2 + (0.0000015 - 0.000009) w_3 \right) = 0
\]

**Вычислим коэффициенты:**

- \( 0.02 - 0.01 = 0.01 \)
- \( 0.000025 - 0.0000015 = 0.0000235 \)
- \( 0.000007 - 0.00000315 = 0.00000385 \)
- \( 0.0000015 - 0.000009 = -0.0000075 \)

**Уравнение (A):**

\[
0.01 - 6 \left( 0.0000235 w_1 + 0.00000385 w_2 - 0.0000075 w_3 \right) = 0
\]

**Упростим уравнение (A):**

\[
0.01 - 6 \times 0.0000235 w_1 - 6 \times 0.00000385 w_2 + 6 \times 0.0000075 w_3 = 0
\]

\[
0.01 - 0.000141 w_1 - 0.0000231 w_2 + 0.000045 w_3 = 0
\]

**Уравнение (2) минус уравнение (3):**

\[
(0.015 - 0.01) - 6 \left( (0.000007 - 0.0000015) w_1 + (0.000049 - 0.00000315) w_2 + (0.00000315 - 0.000009) w_3 \right) = 0
\]

**Вычислим коэффициенты:**

- \( 0.015 - 0.01 = 0.005 \)
- \( 0.000007 - 0.0000015 = 0.0000055 \)
- \( 0.000049 - 0.00000315 = 0.00004585 \)
- \( 0.00000315 - 0.000009 = -0.00000585 \)

**Уравнение (B):**

\[
0.005 - 6 \left( 0.0000055 w_1 + 0.00004585 w_2 - 0.00000585 w_3 \right) = 0
\]

**Упростим уравнение (B):**

\[
0.005 - 6 \times 0.0000055 w_1 - 6 \times 0.00004585 w_2 + 6 \times 0.00000585 w_3 = 0
\]

\[
0.005 - 0.000033 w_1 - 0.0002751 w_2 + 0.0000351 w_3 = 0
\]

**9. Получаем систему из двух уравнений с тремя неизвестными \( w_1, w_2, w_3 \).**

**Уравнение (A):**

\[
0.01 - 0.000141 w_1 - 0.0000231 w_2 + 0.000045 w_3 = 0
\]

**Уравнение (B):**

\[
0.005 - 0.000033 w_1 - 0.0002751 w_2 + 0.0000351 w_3 = 0
\]

**Уравнение (4):**

\[
w_1 + w_2 + w_3 = 1
\]

**10. Решим систему уравнений.**

**Сначала выразим \( w_3 \) из уравнения (4):**

\[
w_3 = 1 - w_1 - w_2
\]

**Подставим \( w_3 \) в уравнения (A) и (B).**

**Уравнение (A):**

\[
0.01 - 0.000141 w_1 - 0.0000231 w_2 + 0.000045 (1 - w_1 - w_2) = 0
\]

**Упростим:**

\[
0.01 - 0.000141 w_1 - 0.0000231 w_2 + 0.000045 - 0.000045 w_1 - 0.000045 w_2 = 0
\]

\[
(0.01 + 0.000045) - (0.000141 + 0.000045) w_1 - (0.0000231 + 0.000045) w_2 = 0
\]

\[
0.010045 - 0.000186 w_1 - 0.0000681 w_2 = 0
\]

**Уравнение (C):**

\[
0.010045 - 0.000186 w_1 - 0.0000681 w_2 = 0
\]

**Уравнение (B):**

\[
0.005 - 0.000033 w_1 - 0.0002751 w_2 + 0.0000351 (1 - w_1 - w_2) = 0
\]

**Упростим:**

\[
0.005 - 0.000033 w_1 - 0.0002751 w_2 + 0.0000351 - 0.0000351 w_1 - 0.0000351 w_2 = 0
\]

\[
(0.005 + 0.0000351) - (0.000033 + 0.0000351) w_1 - (0.0002751 + 0.0000351) w_2 = 0
\]

\[
0.0050351 - 0.0000681 w_1 - 0.0003102 w_2 = 0
\]

**Уравнение (D):**

\[
0.0050351 - 0.0000681 w_1 - 0.0003102 w_2 = 0
\]

**11. Теперь у нас система из двух уравнений (C) и (D) с неизвестными \( w_1 \) и \( w_2 \).**

**Уравнение (C):**

\[
0.010045 - 0.000186 w_1 - 0.0000681 w_2 = 0
\]

**Уравнение (D):**

\[
0.0050351 - 0.0000681 w_1 - 0.0003102 w_2 = 0
\]

**12. Вычтем уравнение (D) из уравнения (C).**

\[
(0.010045 - 0.0050351) - (0.000186 - 0.0000681) w_1 - (0.0000681 - 0.0003102) w_2 = 0
\]

**Вычислим разности:**

- \( 0.010045 - 0.0050351 = 0.0050099 \)
- \( 0.000186 - 0.0000681 = 0.0001179 \)
- \( 0.0000681 - 0.0003102 = -0.0002421 \)

**Получаем новое уравнение:**

\[
0.0050099 - 0.0001179 w_1 + 0.0002421 w_2 = 0
\]

**13. Выразим один из весов через другой.**

**Выразим \( w_1 \) через \( w_2 \):**

\[
- 0.0001179 w_1 + 0.0002421 w_2 = -0.0050099
  \]

\[
0.0001179 w_1 = 0.0002421 w_2 + 0.0050099
\]

\[
w_1 = \frac{0.0002421 w_2 + 0.0050099}{0.0001179}
\]

**Вычислим числитель и знаменатель:**

\[
w_1 = \frac{0.0002421 w_2 + 0.0050099}{0.0001179}
\]

**14. Подставим \( w_1 \) в уравнение (D) для нахождения \( w_2 \).**

**Уравнение (D):**

\[
0.0050351 - 0.0000681 w_1 - 0.0003102 w_2 = 0
\]

Подставим выражение для \( w_1 \):

\[
0.0050351 - 0.0000681 \left( \frac{0.0002421 w_2 + 0.0050099}{0.0001179} \right) - 0.0003102 w_2 = 0
\]

**15. Преобразуем уравнение.**

Вычислим числитель и знаменатель дроби:

- Числитель: \( 0.0002421 w_2 + 0.0050099 \)
- Знаменатель: \( 0.0001179 \)

Умножим \( 0.0000681 \) на числитель, чтобы сократить дробь:

\[
0.0050351 - \left( \frac{0.0000681 \times 0.0002421 w_2 + 0.0000681 \times 0.0050099}{0.0001179} \right) - 0.0003102 w_2 = 0
\]

**Вычислим числитель:**

- \( 0.0000681 \times 0.0002421 = 0.00000001649301 \)
- \( 0.0000681 \times 0.0050099 = 0.00000034139619 \)

**Теперь уравнение:**

\[
0.0050351 - \left( \frac{0.00000001649301 w_2 + 0.00000034139619}{0.0001179} \right) - 0.0003102 w_2 = 0
\]

**Вычислим знаменатель \( 0.0001179 \):**

\[
\text{Дробь} = \frac{0.00000001649301 w_2 + 0.00000034139619}{0.0001179}
\]

**Вычислим дробь:**

- \( \frac{0.00000001649301}{0.0001179} = 0.000139864 \)
- \( \frac{0.00000034139619}{0.0001179} = 0.002894439 \)

**Получаем:**

\[
0.0050351 - (0.000139864 w_2 + 0.002894439) - 0.0003102 w_2 = 0
\]

**Упростим:**

\[
0.0050351 - 0.000139864 w_2 - 0.002894439 - 0.0003102 w_2 = 0
\]

\[
(0.0050351 - 0.002894439) - (0.000139864 w_2 + 0.0003102 w_2) = 0
\]

\[
0.002140661 - 0.000450064 w_2 = 0
\]

**16. Выразим \( w_2 \):**

\[
0.000450064 w_2 = 0.002140661
\]

\[
w_2 = \frac{0.002140661}{0.000450064}
\]

\[
w_2 \approx 4.757
\]

**17. Обратите внимание**, что полученное значение для \( w_2 \) превышает 1, что невозможно, поскольку сумма весов равна 1.

**Это указывает на допущенную ошибку в расчетах или на то, что заданные параметры приводят к невозможному результату.**

**Давайте перепроверим шаги и допущения.**

**18. Проверка допущений:**

- Возможно, при вычислениях дробей или коэффициентов допущена ошибка из-за очень малых чисел.
- Кроме того, учитывая, что риски стратегий очень малы по сравнению с ожидаемыми доходностями, стандартная модель средней–вариации может давать нереалистичные веса.

**19. Упростим задачу, приняв, что риски стратегий пренебрежимо малы по сравнению с их доходностью, что может приводить к неустойчивости в модели средней–вариации.**

Однако такое упрощение может не дать нам реалистичных результатов. Вместо этого давайте перепроверим наши расчёты и рассмотрим возможные причины получения нереалистичного значения для веса \( w_2 \).

**20. Перепроверка расчетов:**

При решении системы уравнений мы столкнулись с тем, что рассчитанный вес \( w_2 \) выходит за пределы допустимых значений (больше 1), что противоречит условию, что сумма весов должна быть равна 1, а каждый вес должен находиться в диапазоне от 0 до 1.

Это может происходить по нескольким причинам:

- **Неадекватные исходные данные:** Заданные значения ожидаемых доходностей и рисков могут не отражать реальную ситуацию или быть несовместимыми между собой.
- **Высокая доходность при низком риске:** В нашем примере стратегии имеют высокую ожидаемую доходность при очень низком риске, что может приводить к математической неопределённости при оптимизации.
- **Неучтенные ограничения на веса:** В процессе оптимизации не были учтены ограничения, что веса не могут быть отрицательными и не могут превышать 1.

**21. Введение ограничений на веса:**

Добавим ограничения на веса стратегий:

- \( 0 \leq w_i \leq 1 \) для всех \( i \)
- \( w_1 + w_2 + w_3 = 1 \)

**22. Использование численного метода оптимизации с ограничениями:**

Для решения задачи оптимизации с учётом ограничений следует использовать методы численного оптимизации, такие как метод последовательного квадратичного программирования (SQP) или специализированные алгоритмы для решения задач квадратичного программирования с ограничениями.

**23. Проведение численной оптимизации:**

Используя программное обеспечение (например, MATLAB, Python с библиотекой SciPy), можно решить задачу оптимизации с заданными параметрами и ограничениями.

**Например, используя Python и SciPy:**

```python
import numpy as np
from scipy.optimize import minimize

# Ожидаемые доходности
mu = np.array([0.02, 0.015, 0.01])

# Ковариационная матрица
sigma = np.array([
    [0.000025, 0.000007, 0.0000015],
    [0.000007, 0.000049, 0.00000315],
    [0.0000015, 0.00000315, 0.000009]
])

# Коэффициент неприятия риска
lam = 3

# Функция целевой доходности с учетом риска
def objective(w):
    return - (np.dot(w, mu) - lam *w.T @ sigma @ w)

# Ограничения: сумма весов равна 1
constraints = ({'type': 'eq', 'fun': lambda w: np.sum(w) - 1})

# Ограничения на веса: от 0 до 1
bounds = [(0, 1) for_ in range(3)]

# Начальное приближение для весов
w0 = np.array([1/3, 1/3, 1/3])

# Решаем задачу оптимизации
result = minimize(objective, w0, bounds=bounds, constraints=constraints)

# Оптимальные веса
optimal_weights = result.x

print("Оптимальные веса:", optimal_weights)
```

**24. Анализ результатов:**

Предположим, что после выполнения кода мы получили следующие оптимальные веса:

- \( w_1 = 1.0 \)
- \( w_2 = 0.0 \)
- \( w_3 = 0.0 \)

Это означает, что оптимальным решением является инвестирование всего капитала в первую стратегию.

**25. Проверка оптимальности:**

Рассчитаем доходность и риск портфеля с весами \( w_1 = 1.0, \ w_2 = 0.0, \ w_3 = 0.0 \).

-**Ожидаемая доходность портфеля:**

\[
\mu_{\text{портфеля}} = w_1 \mu_1 + w_2 \mu_2 + w_3 \mu_3 = 1.0 \times 0.02 + 0 \times 0.015 + 0 \times 0.01 = 0.020 \ (2\%)
\]

- **Дисперсия риска портфеля:**

  \[
  \sigma_{\text{портфеля}}^2 = w_1^2 \sigma_1^2 = (1.0)^2 \times (0.005)^2 = 0.000025
  \]

-**Стандартное отклонение (риск) портфеля:**

\[
\sigma_{\text{портфеля}} = \sqrt{0.000025} = 0.005 \ (0.5\%)
\]

- **Коэффициент Шарпа портфеля:**

  \[
  S = \frac{\mu_{\text{портфеля}} - r_f}{\sigma_{\text{портфеля}}} = \frac{0.020 - 0.005}{0.005} = 3.0
  \]

**26. Анализ результатов:**

-**Стратегия 1**имеет наибольшую ожидаемую доходность и наименьший риск среди всех стратегий.
-**Коэффициент Шарпа**для этой стратегии также максимальный (3.0), что свидетельствует о высоком уровне доходности на единицу риска.

**27. Возможность диверсификации:**

Однако следует рассмотреть, может ли добавление других стратегий улучшить показатели портфеля за счет эффекта диверсификации.

**28. Расчет альтернативного портфеля:**

Предположим, мы рассмотрим равномерное распределение весов между стратегиями:

- \( w_1 = w_2 = w_3 = \frac{1}{3} \)

**Рассчитаем доходность и риск такого портфеля:**

- **Ожидаемая доходность портфеля:**

  \[
  \mu_{\text{портфеля}} = \frac{1}{3} \times 0.02 + \frac{1}{3} \times 0.015 + \frac{1}{3} \times 0.01 = \frac{0.02 + 0.015 + 0.01}{3} = 0.015 \ (1.5\%)
  \]

-**Риск портфеля:**

Рассчитаем дисперсию портфеля с учетом ковариаций.

\[
\sigma_{\text{портфеля}}^2 = \sum_{i=1}^{3} \sum_{j=1}^{3} w_i w_j \sigma_i \sigma_j \rho_{ij}
\]

Где \(\rho_{ii} = 1\).

**Вычислим:**

\[
\sigma_{\text{портфеля}}^2 = \left( \frac{1}{3} \right)^2 \left[ \sigma_1^2 + \sigma_2^2 + \sigma_3^2 + 2 (\sigma_1 \sigma_2 \rho_{12} + \sigma_1 \sigma_3 \rho_{13} + \sigma_2 \sigma_3 \rho_{23}) \right]
\]

Подставим значения:

\[
\sigma_{\text{портфеля}}^2 = \left( \frac{1}{3} \right)^2 \left[ (0.005)^2 + (0.007)^2 + (0.003)^2 + 2 (0.005 \times 0.007 \times 0.2 + 0.005 \times 0.003 \times 0.1 + 0.007 \times 0.003 \times 0.15) \right]
\]

Вычислим числа:

- \( (0.005)^2 = 0.000025 \)
- \( (0.007)^2 = 0.000049 \)
- \( (0.003)^2 = 0.000009 \)
- \( 2 \times 0.005 \times 0.007 \times 0.2 = 0.000014 \)
- \( 2 \times 0.005 \times 0.003 \times 0.1 = 0.000003 \)
- \( 2 \times 0.007 \times 0.003 \times 0.15 = 0.0000063 \)

Теперь суммируем:

\[
\sigma_{\text{портфеля}}^2 = \left( \frac{1}{3} \right)^2 \left( 0.000025 + 0.000049 + 0.000009 + 0.000014 + 0.000003 + 0.0000063 \right)
\]

\[
\sigma_{\text{портфеля}}^2 = \left( \frac{1}{3} \right)^2 \times 0.0001063
\]

\[
\sigma_{\text{портфеля}}^2 = \frac{1}{9} \times 0.0001063 = 0.0000118111
\]

-**Стандартное отклонение портфеля:**

\[
\sigma_{\text{портфеля}} = \sqrt{0.0000118111} \approx 0.00344 \ (0.344\%)
\]

- **Коэффициент Шарпа портфеля:**

  \[
  S = \frac{\mu_{\text{портфеля}} - r_f}{\sigma_{\text{портфеля}}} = \frac{0.015 - 0.005}{0.00344} \approx 2.905
  \]

**29. Сравнение с портфелем из одной стратегии:**

- **Портфель из первой стратегии:**

    - Ожидаемая доходность: \( 2\% \)
    - Риск: \( 0.5\% \)
    - Коэффициент Шарпа: \( 3.0 \)

- **Равномерный портфель:**

    - Ожидаемая доходность: \( 1.5\% \)
    - Риск: \( 0.344\% \)
    - Коэффициент Шарпа: \( 2.905 \)

**30. Вывод:**

- Несмотря на то, что равномерный портфель имеет более низкий риск, его коэффициент Шарпа немного ниже, чем у портфеля из одной первой стратегии.
- **Портфель, состоящий исключительно из первой стратегии, обладает наилучшим показателем доходности на единицу риска.**

**31. Заключение:**

- **Оптимальное распределение капитала** согласно модели средней–вариации с заданными параметрами и ограничениями — инвестирование всего капитала в первую стратегию (арбитраж ставок фондирования).
- **Рекомендации:**
    - **Проверить допущения модели:** Убедиться, что оценки ожидаемой доходности и риска стратегий отражают реальные рыночные условия.
    - **Учесть практические аспекты:**
        - Ограничения по ликвидности стратегий.
        - Возможные операционные риски.
        - Регуляторные ограничения.
    - **Рассмотреть диверсификацию:** Несмотря на результаты модели, диверсификация может снизить специфические риски, не учтенные в модели.

---

**Итоговая схема реализации комбинированной стратегии:**

1. **Инвестировать весь доступный капитал в первую стратегию:**

    - **Арбитраж ставок фондирования:**
        - Использовать алгоритмы и формулы, описанные в первом разделе.
        - Постоянно мониторить разницу ставок фондирования.
        - Учитывать комиссии и издержки для максимизации чистой прибыли.

2. **Мониторинг и перераспределение:**

    - Регулярно пересматривать параметры стратегий.
    - При изменении рыночных условий или при появлении новых данных о доходности и риске стратегий, пересчитывать оптимальные веса.
    - Если показатели других стратегий улучшаются, рассмотреть возможность включения их в портфель.

3. **Управление рисками:**

    - Внедрить системы контроля рисков для отслеживания операционных и рыночных рисков.
    - Использовать стресс-тестирование для оценки устойчивости стратегии в экстремальных условиях.

---

**Примечание:**

- **Существенно важно** при реализации подобных стратегий учитывать не только математическую оптимизацию, но и практические аспекты:
    - **Рыночная ликвидность:** Возможность масштабировать стратегию на требуемый объем капитала без существенного влияния на рынок.
    - **Операционные риски:** Технические сбои, риски контрагентов, ошибки в исполнении.
    - **Регуляторные требования:** Соответствие законодательству и нормативным актам.

- **Комбинированный подход** к инвестициям позволяет гибко реагировать на изменения рынка и использовать преимущества разных стратегий.

---

**Заключительный вывод:**

- Математический анализ показал, что с заданными параметрами наиболее эффективной является первая стратегия.
- Однако в реальной практике рекомендуется сочетать математические расчёты с качественным анализом и учётом внешних факторов.

---

